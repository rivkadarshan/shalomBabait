<!-- src/app/components/add-patient-dialog/add-patient-dialog.component.html -->
<div class="dialog-container" dir="rtl">
    <h1 mat-dialog-title class="dialog-title">
        <mat-icon class="title-icon">person_add</mat-icon>
        הוספת מטופל חדש
    </h1>

    <mat-dialog-content class="dialog-content">
        <form [formGroup]="patientForm" class="patient-form">

            <!-- שדה מזהה משתמש -->
            <mat-form-field appearance="outline" class="full-width">
                <mat-label>מזהה משתמש</mat-label>
                <input matInput type="number" formControlName="user_id" placeholder="הכנס מזהה משתמש" required>
                <mat-icon matSuffix>account_circle</mat-icon>
                <mat-error *ngIf="f['user_id'].invalid && f['user_id'].touched">
                    {{ getErrorMessage('user_id') }}
                </mat-error>
            </mat-form-field>

            <!-- שדה מזהה מטפל -->
            <mat-form-field appearance="outline" class="full-width">
                <mat-label>מזהה מטפל (אופציונלי)</mat-label>
                <input matInput type="number" formControlName="therapist_id" placeholder="הכנס מזהה מטפל">
                <mat-icon matSuffix>medical_services</mat-icon>
            </mat-form-field>

            <!-- תאריך לידה -->
            <mat-form-field appearance="outline" class="full-width">
                <mat-label>תאריך לידה</mat-label>
                <input matInput [matDatepicker]="picker" formControlName="birth_date" [max]="maxDate"
                    placeholder="בחר תאריך לידה">
                <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                <mat-datepicker #picker></mat-datepicker>
                <mat-icon matSuffix>cake</mat-icon>
            </mat-form-field>

            <!-- בחירת מין -->
            <mat-form-field appearance="outline" class="full-width">
                <mat-label>מין</mat-label>
                <mat-select formControlName="gender" placeholder="בחר מין">
                    <mat-option *ngFor="let gender of genderOptions" [value]="gender.value">
                        {{ gender.label }}
                    </mat-option>
                </mat-select>
                <mat-icon matSuffix>wc</mat-icon>
            </mat-form-field>

            <!-- בחירת סטטוס -->
            <mat-form-field appearance="outline" class="full-width">
                <mat-label>סטטוס</mat-label>
                <mat-select formControlName="status" required>
                    <mat-option *ngFor="let status of statusOptions" [value]="status.value">
                        {{ status.label }}
                    </mat-option>
                </mat-select>
                <mat-icon matSuffix>info</mat-icon>
                <mat-error *ngIf="f['status'].invalid && f['status'].touched">
                    {{ getErrorMessage('status') }}
                </mat-error>
            </mat-form-field>

            <!-- הערות היסטוריה -->
            <mat-form-field appearance="outline" class="full-width">
                <mat-label>הערות היסטוריה</mat-label>
                <textarea matInput formControlName="history_notes" rows="3" maxlength="500"
                    placeholder="הכנס הערות היסטוריה רלוונטיות">
        </textarea>
                <mat-hint align="end">
                    {{ f['history_notes'].value?.length || 0 }}/500
                </mat-hint>
                <mat-icon matSuffix>notes</mat-icon>
                <mat-error *ngIf="f['history_notes'].invalid && f['history_notes'].touched">
                    {{ getErrorMessage('history_notes') }}
                </mat-error>
            </mat-form-field>

        </form>
        <mat-dialog-actions class="dialog-actions">
            <div class="action-buttons">

                <!-- כפתור איפוס -->
                <button mat-stroked-button type="button" (click)="onReset()" class="reset-button"
                    [disabled]="isSubmitting">
                    <mat-icon>refresh</mat-icon>
                    איפוס
                </button>

                <!-- כפתור ביטול -->
                <button mat-button type="button" (click)="onCancel()" class="cancel-button" [disabled]="isSubmitting">
                    ביטול
                </button>

                <!-- כפתור שמירה -->
                <button mat-raised-button color="primary" type="submit" (click)="onSubmit()" class="save-button"
                    [disabled]="isSubmitting">

                    <mat-spinner *ngIf="isSubmitting" diameter="20" class="button-spinner">
                    </mat-spinner>

                    <mat-icon *ngIf="!isSubmitting">save</mat-icon>

                    {{ isSubmitting ? 'שומר...' : 'שמור מטופל' }}
                </button>

            </div>
        </mat-dialog-actions>
    </mat-dialog-content>

</div>